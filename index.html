<!DOCTYPE html>
<html lang="zh-cn">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=Edge">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
        <title>本地 | 同乡好运</title>
        <meta name="keywords" content="同乡好运">
        <meta name="description" content="同乡好运">
		<link href="styles/mui.css" rel="stylesheet" />
		<link href="styles/mui.picker.min.css" rel="stylesheet" />
		<link href="styles/txhy.css" rel="stylesheet"/>
    </head>
    <body>
		<header class="mui-bar mui-bar-nav">
		    <h1 class="mui-title">本地</h1>
		</header>
    	
    	<nav class="mui-bar mui-bar-tab">
			<!--当前页 <a> 标签添加 mui-active 类-->
    	    <a class="mui-tab-item mui-active">
    	        <span class="mui-icon mui-icon-home"></span>
    	        <span class="mui-tab-label">本地</span>
    	    </a>
    	    <a class="mui-tab-item">
    	        <span class="mui-icon mui-icon-chatbubble"></span>
    	        <span class="mui-tab-label">动态</span>
    	    </a>
    	    <a class="mui-tab-item">
    	        <span class="mui-icon mui-icon-person"></span>
    	        <span class="mui-tab-label">我的</span>
    	    </a>
    	</nav>
    	
    	<div class="mui-content">
			<form action="" method="post" id="localForm" name="localForm" class="local-form">
				<div class="area" id="areaContainer">
					<label for="area">所在地区</label>
					<input type="text" id="area" name="area" class="mui-input-clear" readonly="readonly" placeholder="请选择所在地区">
					<i class="mui-icon mui-icon-arrowright"></i>
				</div>
				<div class="profession">
					<label for="profession">所在行业</label>
					<select name="profession" id="profession">
						<option value="0">农、林、牧渔业</option>
						<option value="1">采矿业</option>
						<option value="2">制造业</option>
						<option value="3">电力、热燃气及水生产和供应业</option>
						<option value="4">建筑业</option>
						<option value="5">批发和零售业</option>
						<option value="6">交通运输、仓储和邮政业</option>
						<option value="7">住宿和餐饮业</option>
						<option value="8">信息传输、软件和信息技术服务业</option>
						<option value="9">金融业</option>
						<option value="10">房地产业</option>
						<option value="11">租赁和商务服务业</option>
						<option value="12">科学研究和技术服务业</option>
						<option value="13">水利、环境和公共设施管理业</option>
						<option value="14">居民服务、修理和其他服务业</option>
						<option value="15">教育</option>
						<option value="16">卫生和社会工作</option>
						<option value="17">文化、体育和娱乐业</option>
						<option value="18">共公管理、社会保障和社会组织</option>
						<option value="19">国际组织</option>
					</select>
					<i class="mui-icon mui-icon-arrowright"></i>
				</div>
				<div class="mui-input-row mui-search local-search">
					<input type="search" class="mui-input-clear" placeholder="搜索同乡产品或服务">
				</div>
			</form>
			<div class="local-intro">
				<p>联络处简介：<span>XX联络处是同乡聚会...</span></p>
				<p>欢迎大家加入...</p>
			</div>
			<div id="refreshContainer" class="mui-scroll-wrapper">
				<div class="mui-scroll">
					<ul id="localList" class="local-list">
				<li>
					<a href="javascript:;" title="">
						<img src="images/cbd.jpg" alt="">
						<span class="name">张三</span>
						<span class="local-heading">招聘信息</span>
						<time>2017-12-26</time>
						<i class="mui-icon mui-icon-arrowright"></i>
					</a>
				</li>
				<li>
					<a href="javascript:;" title="">
						<img src="images/cbd.jpg" alt="">
						<span class="name">张三</span>
						<span class="local-heading">招聘信息</span>
						<time>2017-12-26</time>
						<i class="mui-icon mui-icon-arrowright"></i>
					</a>
				</li>
				<li>
					<a href="javascript:;" title="">
						<img src="images/cbd.jpg" alt="">
						<span class="name">张三</span>
						<span class="local-heading">招聘信息</span>
						<time>2017-12-26</time>
						<i class="mui-icon mui-icon-arrowright"></i>
					</a>
				</li>
				<li>
					<a href="javascript:;" title="">
						<img src="images/cbd.jpg" alt="">
						<span class="name">张三</span>
						<span class="local-heading">招聘信息</span>
						<time>2017-12-26</time>
						<i class="mui-icon mui-icon-arrowright"></i>
					</a>
				</li>
				<li>
					<a href="javascript:;" title="">
						<img src="images/cbd.jpg" alt="">
						<span class="name">张三</span>
						<span class="local-heading">招聘信息</span>
						<time>2017-12-26</time>
						<i class="mui-icon mui-icon-arrowright"></i>
					</a>
				</li>
				<li>
					<a href="javascript:;" title="">
						<img src="images/cbd.jpg" alt="">
						<span class="name">张三</span>
						<span class="local-heading">招聘信息</span>
						<time>2017-12-26</time>
						<i class="mui-icon mui-icon-arrowright"></i>
					</a>
				</li>
				<li>
					<a href="javascript:;" title="">
						<img src="images/cbd.jpg" alt="">
						<span class="name">张三</span>
						<span class="local-heading">招聘信息</span>
						<time>2017-12-26</time>
						<i class="mui-icon mui-icon-arrowright"></i>
					</a>
				</li>
				<li>
					<a href="javascript:;" title="">
						<img src="images/cbd.jpg" alt="">
						<span class="name">张三</span>
						<span class="local-heading">招聘信息</span>
						<time>2017-12-26</time>
						<i class="mui-icon mui-icon-arrowright"></i>
					</a>
				</li>
				<li>
					<a href="javascript:;" title="">
						<img src="images/cbd.jpg" alt="">
						<span class="name">张三</span>
						<span class="local-heading">招聘信息</span>
						<time>2017-12-26</time>
						<i class="mui-icon mui-icon-arrowright"></i>
					</a>
				</li>
				<li>
					<a href="javascript:;" title="">
						<img src="images/cbd.jpg" alt="">
						<span class="name">张三</span>
						<span class="local-heading">招聘信息</span>
						<time>2017-12-26</time>
						<i class="mui-icon mui-icon-arrowright"></i>
					</a>
				</li>
				<li>
					<a href="javascript:;" title="">
						<img src="images/cbd.jpg" alt="">
						<span class="name">张三</span>
						<span class="local-heading">招聘信息</span>
						<time>2017-12-26</time>
						<i class="mui-icon mui-icon-arrowright"></i>
					</a>
				</li>
				<li>
					<a href="javascript:;" title="">
						<img src="images/cbd.jpg" alt="">
						<span class="name">张三</span>
						<span class="local-heading">招聘信息</span>
						<time>2017-12-26</time>
						<i class="mui-icon mui-icon-arrowright"></i>
					</a>
				</li>
				<li>
					<a href="javascript:;" title="">
						<img src="images/cbd.jpg" alt="">
						<span class="name">张三</span>
						<span class="local-heading">招聘信息</span>
						<time>2017-12-26</time>
						<i class="mui-icon mui-icon-arrowright"></i>
					</a>
				</li>
				<li>
					<a href="javascript:;" title="">
						<img src="images/cbd.jpg" alt="">
						<span class="name">张三</span>
						<span class="local-heading">招聘信息</span>
						<time>2017-12-26</time>
						<i class="mui-icon mui-icon-arrowright"></i>
					</a>
				</li>
				<li>
					<a href="javascript:;" title="">
						<img src="images/cbd.jpg" alt="">
						<span class="name">张三</span>
						<span class="local-heading">招聘信息</span>
						<time>2017-12-26</time>
						<i class="mui-icon mui-icon-arrowright"></i>
					</a>
				</li>
			</ul>
				</div>
			</div>
		</div>

		<script src="scripts/jquery.min.js"></script>
		<script src="scripts/data.city.js"></script>
		<script src="scripts/mui.js"></script>
		<script src="scripts/mui.picker.min.js"></script>
		<script>
			/*(function() {
				mui.init({
                    pullRefresh : {
                        container: localList,//待刷新区域标识，querySelector能定位的css选择器均可，比如：id、.class等
                        up : {
                            height: 50,//可选.默认50.触发上拉加载拖动距离
                            auto: true,//可选,默认false.自动上拉加载一次
                            contentrefresh : "正在加载...",//可选，正在加载状态时，上拉加载控件上显示的标题内容
                            contentnomore: '没有更多数据了',//可选，请求完毕若没有更多数据时显示的提醒内容；
                            callback: localListPullFresh //必选，刷新函数，根据具体业务来编写，比如通过ajax从服务器获取新数据；
                        }
                    }
				});

                function localListPullFresh() {
                    // toDoSometing 业务逻辑代码，比如通过ajax从服务器获取新数据；

                    //注意：
                    //1、加载完新数据后，必须执行如下代码，true表示没有更多数据了：
                    //2、若为ajax请求，则需将如下代码放置在处理完ajax响应数据之后
                    this.endPullupToRefresh(false);
                }

                //选择省市区
                var city_picker = new mui.PopPicker({
                    layer:2 // 显示列数，这里显示省市2列
                });
                city_picker.setData(init_city_picker);
                $("#areaContainer").on("tap", function(){
                    city_picker.show(function(items){
                        $("#area").val((items[0] || {}).text + " " + (items[1] || {}).text);
                    });
                });

			})();*/
			mui.init({
				pullRefresh : {
					container: "#refreshContainer",//待刷新区域标识，querySelector能定位的css选择器均可，比如：id、.class等
					up : {
						height: 50,//可选.默认50.触发上拉加载拖动距离
						auto: false,//可选,默认false.自动上拉加载一次
						contentrefresh : "正在加载...",//可选，正在加载状态时，上拉加载控件上显示的标题内容
						contentnomore: '没有更多数据了',//可选，请求完毕若没有更多数据时显示的提醒内容；
						callback: localListPullFresh //必选，刷新函数，根据具体业务来编写，比如通过ajax从服务器获取新数据；
					}
				}
			});

			function localListPullFresh() {
				//mui('#localList').pullRefresh().disablePullupToRefresh();
				$.ajax({
					url:"wx/loadindexdata",
					type:"POST",
					data:$("#localForm").serialize(),
					dataType:"JSON",
					success:function(data){
						$("#pageNo").val(data.pageNo);
						if(data.list.length!=0){
							var html = "";
							$.each(data.list,function(index,bi){
								html = html + "<li>" +
									"<a href=\"javascript:;\" title=\"\">" +
									"<img src=" + bi.userBaseInfo.head + " alt=\"\">" +
									"<span class=\"name\">" + ifnull(bi.userBaseInfo.nickname) + "</span>" +
									"<span class=\"local-heading\">" + bi.mainBusin + "</span>" +
									"<i class=\"mui-icon mui-icon-arrowright\"></i>" +
									"</a>" +
									"</li>";
							});
							$("#localList").append(html);

							//注意：
							//1、加载完新数据后，必须执行如下代码，true表示没有更多数据了：
							//2、若为ajax请求，则需将如下代码放置在处理完ajax响应数据之后
							mui('#localList').pullRefresh().endPullupToRefresh(false);
						}
						else{
							mui('#localList').pullRefresh().endPullupToRefresh(true);
						}
					},error:function(){
						mui('#localList').pullRefresh().endPullupToRefresh(true);
					}
				});
			}

			mui(".mui-scroll-wrapper").scroll({
				indicators:false
			});

			function ifnull(str){
				if(str == null || str == "undefined"){
					return "";
				}
				else{
					return str;
				}
			}

			document.getElementById('todynamic').addEventListener('tap', function() {
				mui.openWindow({
					url: 'wx/dynamic'
				});
			});

			document.getElementById('tomy').addEventListener('tap', function() {
				mui.openWindow({
					url: 'wx/tomy'
				});
			});

			//选择省市区
			var city_picker = new mui.PopPicker({
				layer:2 // 显示列数，这里显示省市2列
			});
			city_picker.setData(init_city_picker);
			city_picker.pickers[0].setSelectedIndex(22);
			city_picker.pickers[1].setSelectedIndex(0);
			if (true){
				var okbtn = document.getElementsByClassName("mui-poppicker-btn-ok");
				city_picker.show(function(items){
					$("#area").val(items[0].text + " " + items[0].children[0].text);
				});
				mui.trigger(okbtn[0], 'tap');
			}

			$("#areaContainer").on("tap", function(){
				city_picker.show(function(items){
					$("#area").val((items[0] || {}).text + " " + (items[1] || {}).text);
					//console.log(items[1]);
					$("#cityName").val(items[1].text);
				});
			});

			$("#searchinput").blur(function(){
				if($("#searchinput").val()!=""){
					$("#localForm").submit();
				}
			});
		</script>
	</body>
</html>